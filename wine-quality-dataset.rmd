Red Wine Chemistry Analysis by Tom McKenzie
========================================================

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=12, fig.height=8, fig.path='Figs/',
                      echo=FALSE, warning=FALSE, message=FALSE)

```


# Abstract

Aim of this project is to analyse the "wineQualityReds" dataset. This dataset contains 1599 observations over 13 variables that describe chemical aspects of a given red wine, including a qualitative rating of the wine taste/quality.

## Load data

Downloaded the file as .csv and stored in project directory.

Read into dataframe object using read.csv() function.

```{r echo=FALSE, message=FALSE, warning=FALSE, packages}
# Load all of the packages that you end up using in your analysis in this code chunk.

# Notice that the parameter "echo" was set to FALSE for this code chunk. This
# prevents the code from displaying in the knitted HTML output. You should set
# echo=FALSE for all code chunks in your file, unless it makes sense for your
# report to show the code that generated a particular plot.

# The other parameters for "message" and "warning" should also be set to FALSE
# for other code chunks once you have verified that each plot comes out as you
# want it to. This will clean up the flow of your report.

library(ggplot2)
library(dplyr)
library(RColorBrewer)
library(GGally)

```

```{r echo=FALSE, Load_the_Data}
# Load the Data
wine <- read.csv("wineQualityReds.csv")
wine$total.acidity <- wine$fixed.acidity + wine$volatile.acidity
summary(wine)
```

The dataset contains several distinct variables corresponding to chemical components. Some appear related (e.g. 'free.sulfur.dioxide' and 'total.sulfur.dioxide'), while others at first glance appear distinct. There is a variable called 'X' which appears to be just a unique 'id' or index column.
I'll remove this from the dataset as it is unecessary..

```{r}
wine$X <- NULL
```


# Univariate Plots Section

Check out the histogram of "quality" ratings, as this is perhaps the variable of most interest in this investigation.

```{r echo=FALSE, Univariate_Plots}
qplot(x=quality, data=wine, geom=c('bar'))
```

The quality ratings appear to be integer values only, with the vast majority given ratings of 5 - 7. Note, a binwidth of 1 is used as the values can only be integers.

Will now check out the other variables individually to get an idea (visually) of how they are distributed.

Variable: 'fixed.acidity'; Plot: histogram.

```{r echo=FALSE, Univariate_Plots1}
qplot(x=fixed.acidity, data=wine, binwidth=.2)

# remove outliers with values >14. Plot on log10 scale to account for long-tailed distribution.
qplot(x=fixed.acidity, data=subset(wine, fixed.acidity < 14), binwidth=.2) +
  coord_trans(x='log10')
```

After removing the outliers and converting the x-axis to a log scale a monomodal distribution is obtained with a peak around 7.

```{r echo=FALSE, Univariate_Plots2}
sub.fixed.acidity <- subset(wine, fixed.acidity < 14)
summary(sub.fixed.acidity$fixed.acidity)
```

The mean of this distribution is 8.281% and the median is 7.900%.

Variable: 'volatile.acidity'; Plot: histogram.

```{r}
qplot(x=volatile.acidity, data=wine, binwidth=.02)

# remove outliers with values > 1.0.
qplot(x=volatile.acidity, data=subset(wine, volatile.acidity < 1), binwidth=.02)
```

After removing outliers, the distribution is approximately symmetrical even without log scaling. The may be two peaks present, but the count values are relatively low so it could just be an artefact of the small dataset.

Summary statistics for the volatile.acidity variable:

```{r echo=FALSE, Univariate_Plots3}
sub.volatile.acidity <- subset(wine, volatile.acidity < 1)
summary(sub.volatile.acidity$volatile.acidity)
```

The mean is 0.519%, and the meadian is 0.520%. 

Variable: 'total.acidity'; Plot: histogram.

```{r echo=FALSE, Univariate_Plots4}
qplot(x=total.acidity, data=wine, binwidth=.2)

# remove outliers with values > 15. Plot on log10 scale to account for long-tailed distribution.
qplot(x=total.acidity, data=subset(wine, total.acidity < 15), binwidth=.2) +
  coord_trans(x='log10')
```

The distribution of the calculated variable 'total.acidity' is approximately normal after a log transformation. This is not suprising as the major compenent of total.acidity is fixed.acidity, which required the same transformation.

Variable: 'sulphates'; Plot: histogram.

```{r echo=FALSE, Univariate_Plots5}
qplot(x=sulphates, data=wine, binwidth=.02)

# remove outliers with values > 1.25. Plot on log10 scale to account for long-tailed distribution.
qplot(x=sulphates, data=subset(wine, sulphates < 1.25), binwidth=.02) +
  coord_trans(x='log10')
```

After a log transformation this is now a very nice normal distribution, with a peak around 0.6%.

Summary statistics for the sulphates variable:

```{r echo=FALSE, Univariate_Plots6}
sub.sulphates <- subset(wine, sulphates < 1.25)
summary(sub.sulphates$sulphates)
```

The mean for sulphates is 0.6487%, with a median value of 0.6200%.

Variable: 'alcohol'; Plot: histogram.

```{r echo=FALSE, Univariate_Plots7}
qplot(x=alcohol, data=wine, binwidth=.1)

# remove outliers with values > 1.25. Plot on log10 scale to account for long-tailed distribution.
qplot(x=alcohol, data=subset(wine, alcohol < 14), binwidth=.1) +
  coord_trans(x='log10')
```

We see that even after log transformation the data is still strongly positively skewed. May be better transformed using a different function.

Summary statistics for the alcohol variable:

```{r echo=FALSE, Univariate_Plots8}
sub.alcohol <- subset(wine, alcohol < 14)
summary(sub.alcohol$alcohol)
```

The mean alcohol percentage is 10.4%, with a median value of 10.1%.

Variable: 'pH'; Plot: histogram.

```{r echo=FALSE, Univariate_Plots9}
qplot(x=pH, data=wine, binwidth=.02)

# remove outliers below 2.75 and above 3.75
qplot(x=pH, data=subset(wine, (pH > 2.75 & pH < 3.75)), binwidth=0.02)
```

Even without log transformation this distribution appears roughly symmetrical, with a peak around a pH value of 3.3.

Summary statistics for the alcohol variable:

```{r echo=FALSE, Univariate_Plots10}
sub.pH <- subset(wine, (pH > 2.75 & pH < 3.75))
summary(sub.pH$pH)
```

The mean pH was 3.309, and the median was 3.310.

# Univariate Analysis

### What is the structure of your dataset?

The data is already in a relatively 'tidy' format. The only 'cleaning' that was applied was removal of the unecessary 'X' column (which was effectively an index).

However, the variable units are unknown. I have assumed that the chemical components like 'acidity' and 'chlorides' might be reported as a percentage, much like the 'alcohol' variable (which, based off my prior domain knowledge, is almost certainly in vol%). The 'density' and 'pH' variables are likely in 'g/cm3' and unitless, respectively, while the 'quality' rating is a basic 0 - 10 scale, with 0 being the "worst" and 10 the "best". These units will be used for the rest of the analysis.

### What is/are the main feature(s) of interest in your dataset?

I am most intested in seeing how the physico-chemical elements affect the "quality" rating, as given by a panel of 3 wine experts.
I am also rather suprised at the acidity of wine, with 75% of the wines having a pH of less than 3.5.

### What other features in the dataset do you think will help support your investigation into your feature(s) of interest?

I think significant chloride and sulphate contents may negatively impact the rating given to a particular wine.

### Did you create any new variables from existing variables in the dataset?

A variable called 'total.acidity' that is the sum of the 'fixed.acidity' and 'volatile.acitity' was created as a simplification for the effect of acidity.

### Of the features you investigated, were there any unusual distributions? Did you perform any operations on the data to tidy, adjust, or change the form of the data? If so, why did you do this?

The 'alcohol' percentage was skewed quite strongly. Even after applying a log10 scaling transformation the distribution was still long-tailed.
Otherwise, the variables investigated were monomodal and approximately normally-distributed, perhaps as expected for these kinds of data and given the uniformity of the wine industry (e.g. no extreme outliers, as consumers would likely not appreciate compositions that differed markedly from what they were used to!).

# Bivariate Plots Section

First, I'd like to create a scatterplot matrix on a sample of the data. I'll save the generated plot as an image to refer to later.

```{r echo=FALSE, Bivariate_Plots}
theme_set(theme_minimal())
ggpairs(sample(wine))
ggsave('scatter.png', width = 10, height = 7, units = "in")
```

It appears that the strongest bivariate correlation with 'quality' is 'alcohol', with a correlation coefficient of 0.476. Also, 'quality' is negatively correlated with 'volatile.acidity', with a coefficient of -0.391.

These both seem like reasonable observations. Some other logical correlations are the 'acidity'/'acid' variables with 'pH' (e.g. 'fixed.acidity' and 'pH' (-0.683)), and the 'alcohol' with 'density' (-0.496), given that acids lower the pH and alcohol is less dense than water (the other primary constituent of wine).

Overall, there are not too many suprising correlations in the scatterplot matrix. However, I'd like to investigate the relationships with quality further.

```{r echo=FALSE, Bivariate_Plots1}
ggplot(aes(x=alcohol, y=quality), data = wine) + 
  geom_point()
```

Given the integer nature of the quality rating and the overploting on the scatterplot, this might actually be better as a structured boxplot.

```{r echo=FALSE, Bivariate_Plots2}
# create box plot function for general use.
# use 'cut_width()' to group 'continuous' quality rating
# into groups.
plot.box <- function(y.var, df){
  ggplot(data = df, aes_string(y = y.var, x = "quality")) +
    geom_boxplot(aes(group = cut_width(quality, 1)))
}

plot.box("alcohol", wine)
```

It is quite clear from this boxplot that the higher quality wines have higher alcohol contents, with the median alcohol content for ratings of 7 and 8 both significantly higher than the other median values.

See what effect chlorides and sulphates have on rating.

First lets look at a box plot of the chloride content for different rating values.

```{r echo=FALSE, Bivariate_Plots3}
# look at boxplot of chloride content for different ratings.
plot.box("chlorides", wine)
```

There are many outliers for the middle rating values, however it appears that decreasing chloride content is better.

Next, let's plot the same thing for sulphate content.

```{r echo=FALSE, Bivariate_Plots4}
# boxplot of sulphate content for different rating values
plot.box("sulphates", wine)
```

This is somewhat unexpected. Again, there is large variablility in the middle rating values, however it appears that higher contents of sulphates result in better quality ratings.

Now look at pH.

```{r echo=FALSE, Bivariate_Plots5}
ggplot(aes(x=quality, y=pH), data=wine) +
  geom_jitter(aes(alpha=0.5))
```

No clear relationship observed. There are lots of outliers, but most points are clustered around the median pH and quality values.

I want to see how the citric acid levels affect the pH.

```{r echo=FALSE, Bivariate_Plots6}
ggplot(aes(x=pH, y=citric.acid), data=wine) +
  geom_point(alpha=1/2)
```

This clearly indicates a negative linear relationship between citric acid and pH.

I want to see the effect on pH of all the acidity-based variables (including 'total.acidity'). Will arrange scatterplots in a grid to see this.

```{r echo=FALSE, Bivariate_Plots7}
library(gridExtra)

# alpha values reduced to overcome overplotting
citric_acid <- ggplot(aes(x=pH, y=citric.acid), data=wine) +
  geom_point(alpha=1/10)

vol_acid <- ggplot(aes(x=pH, y=volatile.acidity), data=wine) +
  geom_point(alpha=1/10)

fix_acid <- ggplot(aes(x=pH, y=fixed.acidity), data=wine) +
  geom_point(alpha=1/10)

tot_acid <- ggplot(aes(x=pH, y=total.acidity), data=wine) +
  geom_point(alpha=1/10)

grid.arrange(citric_acid, vol_acid, fix_acid, tot_acid)
```

This now clearly shows that the volatile.acidity does not effect the pH of the wine. This might also explain why, given the moderate negative correlation between volatile.acidity and quality observed in the scatterplot matrix, no relationship was observed in the scatterplot of pH and quality.

Can look more closely at the negative correlation between the 'volatile.acidity' and the wine quality with a simple boxplot.

```{r echo=FALSE, Bivariate_Plots8}
plot.box("volatile.acidity", wine)
```

It certainly appears that lowering the volatile acidity correlates with an improvement in the quality.

Does 'residual.sugar' correlate with 'alcohol' content?

```{r echo=FALSE, Bivariate_Plots9}
ggplot(aes(x=alcohol, y=residual.sugar), data=wine) +
  geom_jitter(alpha = 1/3)
```

I would initially assume that given fermentation converts sugars into alcohol, higher alcohol contents would lead to lower residual sugar contents. Although a few outliers with high residual sugar levels and low alcohol contents may indicate this effect slightly, perhaps it depends also on other factors like the amount of initially-added sugar, for which we don't have the data.

Do the judges like sweet wines?

```{r echo=FALSE, Bivariate_Plots10}
sugary_wines <- subset(wine, residual.sugar >= 4.5)
summary(sugary_wines$quality)
summary(wine$quality)
```

Maybe! Although the medians values are both 6.0, the mean for the 'sugary wines' is slightly higher than that of the entire selection of wines (5.703 vs 5.636).

Check to see if 'free.sulfur.dioxide' correlates with 'total.sulfur.dioxide'.

```{r echo=FALSE, Bivariate_Plots11}
ggplot(data=wine, aes(x=total.sulfur.dioxide, y=free.sulfur.dioxide)) +
  geom_point(alpha=1/5)
```

This does appear to be a positive correlation, but it becomes quite broad at higher values. Will take the sqrt() of both axes.

```{r echo=FALSE, Bivariate_Plots12}
ggplot(data=wine, aes(x=total.sulfur.dioxide, y=free.sulfur.dioxide)) +
  geom_point(alpha=1/5) +
  coord_trans(x='sqrt', y='sqrt')
```

This transformed plot appears more uniformly linear.

# Bivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. How did the feature(s) of interest vary with other features in the dataset?

It was interesting to note the strongest correlations with 'quality' were alcohol content and the volatile acidity. Perhaps having a strongly acidic aroma is off-putting, affecting the percieved quality of the wine.

### Did you observe any interesting relationships between the other features (not the main feature(s) of interest)?

The relationship between residual.sugar and alcohol content was of interest to me. I would've assumed that higher alcohol contents resulted in lower residual.sugar values, however there was only a very weak realtionship. There may be other factors that go into determining the levels of residual.sugar that we don't have the data for.

### What was the strongest relationship you found?

The relationships between acidity/acid content and the pH were obviously very strong. However, in terms of the 'quality' variable of interest, the strongest correlation was with alcohol content, with higher alcohol content wines receiving higher quality ratings.

# Multivariate Plots Section

Will plot alcohol vs quality, with color-coding for the volatile.acidity variable to see if any obvious trend exists. Will scale the achohol axis to log10 to try account for its skewed distribution.

```{r echo=FALSE, Multivariate_Plots}
ggplot(data = wine, aes(x=alcohol, y=quality, color=volatile.acidity)) +
  geom_jitter(alpha=1/5) +
  scale_x_log10('alcohol', c(0, 20))
```

It is hard to distinguish any trends based on the color-coding in this plot. The individual boxplots showed the correlation more clearly.

Will try adding the 'quality' as a third variable to our sulfur.dioxide plot from earlier.

```{r echo=FALSE, Multivariate_Plots1}
# removed outliers above free. = 60 and total. = 200
ggplot(data=subset(wine, (free.sulfur.dioxide < 60 & total.sulfur.dioxide < 200)),
       aes(x=total.sulfur.dioxide, y=free.sulfur.dioxide, color=as.factor(quality))) +
  geom_point(alpha=1/3) +
  coord_trans(x='sqrt', y='sqrt') +
  scale_color_brewer(type = 'seq')
```

Again this is quite difficult to see a trend. The quality appears to not be correlated with sulfur.dioxide content. This seems reasonable given their low correlation in the scatterplot matrix (< 0.3).

Wanted to look at quality with volatile.acidity, and see if a relationship with citric.acid content was also present.

```{r echo=FALSE, Multivariate_Plots2}
# plot with color as citric acid content.
# changed color "type" to 'seq' so that a single gradient was used
# the citric.acid variable was 'cut' into arbitrary chunks of 0.15 units
# to give < 8 groups (required for the gradient color palette)
ggplot(data=wine, aes(x=volatile.acidity, y=quality, color=cut_width(citric.acid, 0.15))) +
  geom_jitter(alpha=1/3) +
  scale_color_brewer(type = 'seq')
```

Although there does not appear to be a vertical relationship for citric.acid (i.e. with quality), a horizontal trend is apparent, with lower volatile.acidity's having higher citric.acid contents (darker points).
This was unexpected - i.e., higher citric.acid contents correspond to lower volatile.acidity. It may be because citric.acid is non-volatile, and so if there is a higher content of it there is a correspondingly lower content of more volatile acids.

Lastly, I wanted to confirm the correlation between density and alcohol content.

```{r echo=FALSE, Multivariate_Plots3}
ggplot(data=wine, aes(x=alcohol, y=density, color=as.factor(quality))) +
  geom_point(alpha=1/2, position = 'jitter') +
  scale_color_brewer(type='seq')
```

This plot demonstrates the negative correlation between density and alcohol, although the effect of these variables on the quality is hard to discern.

# Multivariate Analysis

### Talk about some of the relationships you observed in this part of the investigation. Were there features that strengthened each other in terms of looking at your feature(s) of interest?

The combined effect of volatile.acidity and alcohol on the quality rating was difficult to clearly illustrate using multivariate analysis.

It was nice to visualize the clear effect of alcohol content on the density of the wine, and also overlay the quality rating for these. Did the higher alcohol content wines receive better quality ratings because of the alcohol, or because of their lower densities?

### Were there any interesting or surprising interactions between features?

The use of citric.acid as a third variable in the plot of quality vs volatile.acidity provided an interesting observation in that lower volatile.acidity values generally had higher citric.acid contents. This was contrary to previous expectations.

------

# Final Plots and Summary

### Plot One
```{r echo=FALSE, Plot_One}
plot.box("volatile.acidity", wine) +
  ylab('Volatile acidity (%)') +
  scale_x_continuous(name='Quality rating (0 - 10)', breaks=c(3,4,5,6,7,8)) +
  ggtitle('Volatile acidity vs quality rating')

```

### Description One

This was one of the strongest correlating variables with the 'quality' of the wine - albeit negatively correlated.
The box plot shows this most clearly that decreasing volatile acidity correlates with increasing wine quality.

### Plot Two
```{r echo=FALSE, Plot_Two}
# note: jitter added because values seemed to be in .1 increments
ggplot(aes(x=pH, y=volatile.acidity), data=wine) +
  geom_point(alpha=1/4, color='royalblue', position = 'jitter') +
  ylab('Volatile acidity (%)') +
  ggtitle('Volatile acidity vs wine pH')

```

### Description Two

This plot was of interest to me, as it demonstrates that the volatile acidity does not correlate with pH. This was somewhat unexpected, as one would expect that the volatile acidity may effect the acidity of the wine itself (measured as the pH) - i.e. more acid gives lower pH. This does not appear to be the case, at least for the volatile acids.
I added an alpha factor to overcome the overplotting, and also added a 'jitter' as the pH values seemed to only change by 0.1 increments.

### Plot Three
```{r echo=FALSE, Plot_Three}
ggplot(data=wine, aes(x=volatile.acidity, y=quality, color=cut_width(citric.acid, 0.15))) +
  geom_jitter(alpha=1/2) +
  ylab('Quality rating (0 - 10)') +
  xlab('Volatile acidity (%)') +
  ggtitle('Quality vs volatile acidity and citric acid content') +
  theme(legend.position="right") +
  labs(color='Citric acid (%)') +
  scale_color_brewer(type = 'seq') +
  scale_y_continuous(breaks = c(3,4,5,6,7,8))
```

### Description Three

This plot illustrates the decreasing quality of wines with increasing volatile acidity. However, when the citric acid content is added we see an inverse relationship between volatile acidity and citric acidity, which was unexpected.


# Reflection

This dataset was not very large, only 1599 observations over 13 variables. Moreover, the variable of interest to me ('quality') ended up being quite difficult to analyse effectively due to the small range of possible integer values it could take (all between 3 and 8).

Despite these challenges, some insights into the effects of various chemical components on wine 'quality' could be gained. The largest correlations observed were an increase in quality with alcohol content, and a decrease in quality with volatile acidity.

The better outcomes for higher alcohol contents may be due to a combination of related factors, such as fermentation time, or reduced sweetness. However, the latter was investigated by plotting residual.sugar vs alcohol, and displayed at best a very weak correlation. Not suprisingly, the increasing alcohol content correlated with a decrease in density (due to the inherent physical properties of ethanol and water), but I believe that to be an unlikely contributing variable to the increased quality as judged by the wine tasters.
High volatile acidities giving poorer quality ratings makes sense to me, as an acidic wine aroma can be off-putting.

It would be interesting to try to build a model to predict quality based on these two primary variables (i.e. alcohol and volatile acidity), although I expect we would need significantly more data points to get a reliable predictor as the alcohol content can not go up much more without becoming off-putting. Therefore, this model may be quite complex.
